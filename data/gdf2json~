#!/usr/bin/env python
import json
import tokenize
import re

# PARAMETERS INIT #

nParticipants = 145
nArticles = 183
gdf_name = "bipartite_nodes_CSCW2013_URL_time.gdf"  # input file name
json_name = "data"                                  # output file name (no .json nor .*)
sample_mode = True  # To generate the whole data, change sample_mode to false

if (sample_mode) :
    pDel = 10
    aDel = nParticipants + 10
    json_name += "Sample.json"
else :
    pDel = nParticipants
    aDel = nParticipants + nArticles
    json_name += ".json"

# GDF TO JSON FUNCTION #

def gdf2json (gdf_file) :

    content = gdf_file.readlines()
    json_data = {}
    elem_list = {}
    part = {}
    art = {}
    part_list = []
    art_list = []
    saved = False

    json_file = open(json_name, "w")

    for i,c in enumerate(content) :
        if (i <= pDel and i > 0):
            elem_list = c.rstrip("'\n").split("','");
            #elem_list = re.split('\',\' | \'\n', c)
            if(len(elem_list) == 6):

                part['userId'] = elem_list[0]
                part['userLabel'] = elem_list[1]
                part['userLabelShort'] = elem_list[2]
                part['userType'] = elem_list[3]
                part['userUrl'] = elem_list[4]
                part['userDate'] = elem_list[5]

                part_list.append(part)

        elif (i > nParticipants and i <= aDel) :
            elem_list = c.rstrip("'\n").split("','");
            #elem_list = re.split('\',\' | \'\n', c)
            if(len(elem_list) == 6):

                art['paperId'] = elem_list[0]
                art['paperLabel'] = elem_list[1]
                art['paperLabelShort'] = elem_list[2]
                art['paperType'] = elem_list[3]
                art['paperUrl'] = elem_list[4]
                art['paperDate'] = elem_list[5]

                art_list.append(art)
                
    print (len(part_list))
    json_file.write("{\n\"users\" : " + json.dumps(part_list, json_file, indent=4))
    json_file.write(",\n\"papers\" : " + json.dumps(art_list, json_file, indent=4) + "\n}")

    # TODO: also append later relations in the GDF file

    return True

def main () :

    # FILE POINTERS #
    gdf_file = open(gdf_name, "r")

    # JSON CREATION #
    if(sample_mode):
        print ("Note: Sample mode is on")
    if( gdf2json(gdf_file) ):
        print ("Written to: " + json_name + "\n")

main();
